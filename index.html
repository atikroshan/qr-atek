<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>UPI Payment QR Code Generator</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"/>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<style>
/* Your styles here, unchanged for brevity */
body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
}
.container {
    max-width: 500px;
    margin: 50px auto;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    background-color: #4f6377;
}
.square-outline {
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}
.error-message {
    color: red;
    text-align: center;
    margin-top: 10px;
}
#myModal {
    z-index: 10000;
}
.modal-body {
    text-align: left;
    padding: 20px;
    background-color: #4f6377;
}
.modal-body p {
    margin-bottom: 20px;
}
.labels {
    display: inline-block;
    vertical-align: top;
    margin-right: 20px;
}
#amount-label {
    text-align: right;
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    margin-top: 20px;
}
#amount-value {
    font-size: 64px;
    font-weight: bold;
}
#detail-section {
    margin-top: 20px;
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
}
.option-value {
    font-weight: bold;
    margin-top: 20px;
}
.modal-header {
    padding: 20px;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #4f6377;
}
#description-modal-label {
    margin-top: 15px;
}
.form-group {
    margin-bottom: 20px;
}
label {
    display: block;
    margin-bottom: 10px;
    color: #ffffff;
}
.form-control {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
}
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    background-color: #F4364C;
    color: #fff;
    cursor: pointer;
}
.btn:hover {
    background-color: #FF6B81;
}
.card {
    border: 1px solid #ddd;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    padding: 20px;
    background-color: #ffffff;
}
.card_focus {
    outline: none;
    box-shadow: none;
}
.card:focus {
    outline: none;
    box-shadow: none;
}
.card-header {
    background: linear-gradient(to right, #03055B, #87CEEB);
    color: #ffffff;
    border-bottom: 1px solid #1877F2;
    padding: 10px;
    text-align: center;
    font-size: 20px;
}
.card-body {
    padding: 20px;
    text-align: center;
    background-color: #ffffff;
}
.card-footer {
    background-color: #ffffff;
    border-top: 1px solid #fff;
    padding: 10px;
    text-align: center;
}
.qrcode-container {
    text-align: center;
    margin: 20px auto;
    display: flex;
    justify-content: center;
    align-items: center;
}
.qrcode {
    margin: 0 auto;
}
#qrcode-wrapper {
    background-color: #4f6377;
    padding: 20px;
}
.download-btn-container {
    text-align: center;
    margin-top: 5px;
}
.close-btn {
    background-color: #F4364C;
    color: #fff;
    border: none;
    padding: 5px 10px;
    font-size: 16px;
    cursor: pointer;
}
.close-btn:hover {
    background-color: #FF6B81;
}
#myModalLabel {
    text-align: center;
    color: white;
}
.modal-content {
    padding: 10px;
    background-color: #4f6377;
    border: none;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
}
.modal-backdrop {
    background-color: #4f6377;
}
.modal {
    background-color: #000000;
}
#qrcode-modal {
    text-align: center;
}
#qrcode-modal img {
    margin: 0 auto;
    display: block;
}
.payment-logos {
    margin-top: 20px;
    width: 275px;
    height: 20px;
}
.pay-to-label {
    font-size: 24px;
}
.divider {
    border-top: 2px solid #ddd;
    margin: 10px 0;
}
.label-text {
    font-weight: normal;
    color: #000000;
}
.bold-text {
    font-weight: bold;
    color: #FF0000;
}
.heavy-bold-text {
    font-weight: 900;
}
</style>
</head>
<body>
<div class="container">
<div class="square-outline">
<form id="qr-form">
<div class="form-group">
<label for="upi-id">Select UPI ID:</label>
<select id="upi-id" class="form-control">
<option value="9960171516@ybl">A-tek Printing Press</option>
<option value="9970595659@ybl">Atek Printing Press</option>
</select>
</div>
<div class="form-group">
<label for="amount">Enter Amount:</label>
<input type="number" id="amount" placeholder="Amount" class="form-control" min="0" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"/>
</div>
<div class="form-group">
<label for="description">Select Description:</label>
<select id="description-select" class="form-control">
<option value="Banner">Banner</option>
<option value="Visiting Card">Visiting Card</option>
<option value="Envelope">Envelope</option>
<option value="Stickers">Stickers</option>
<option value="Coupons / Vouchers">Coupons / Vouchers</option>
<option value="Bill Book">Bill Book</option>
<option value="Letter Pad">Letter Pad</option>
<option value="Pamplets">Pamplets</option>
<option value="Shopping Bags">Shopping Bags</option>
<option value="Wedding Card">Wedding Card</option>
<option value="">Other</option>
</select>
</div>
<div class="form-group" id="other-description" style="display: none;">
<label for="other-description-text">Enter Description:</label>
<input type="text" id="other-description-text" class="form-control"/>
</div>
<div class="form-group" id="quantity-field">
<label for="quantity">Enter Quantity:</label>
<input type="number" id="quantity" placeholder="Quantity" class="form-control" min="1" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>
</div>
<button type="submit" class="btn btn-primary btn-block">Generate QR Code</button>
<button type="button" class="btn btn-link" data-toggle="modal" data-target="#myModal" id="modal-btn" style="display: none;">Modal</button>
<div class="error-message" id="error-message"></div>
</form>
</div>
</div>
<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
<div class="modal-dialog" role="document">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title" id="myModalLabel" style="color: white;">Generated QR Code</h5>
<button class="close-btn" id="close-btn" onclick="closeModal()">X</button>
</div>
<div class="modal-body" id="modal-body">
<div id="qrcode-wrapper">
<div class="card card-focus" id="qrcode-card">
<div class="card-header" style="font-size: 24px;">
<h1><b>PAYMENT</b></h1>
</div>
<div class="card-body">
<p style="text-align: center;" class="pay-to-label"><span class="label-text">PAY TO : </span><span class="bold-text heavy-bold-text">ATEK DIGITAL</span><br/><span id="upi-id-modal-label2"></span></p>
<div class="qrcode-container">
<div id="qrcode-modal" class="qrcode"></div>
</div>
<img src="https://i.postimg.cc/kGhDzjL4/upi.png" alt="UPI" class="payment-logos" />
<p style="text-align: center;">Amount: <span id="amount-value"></span></p>
<div class="divider"></div>
<p style="text-align: center;">Description: <span id="description-modal-label"></span></p>
<div class="divider"></div>
<p id="quantity-modal-label" style="text-align: center;">Quantity: </p>
</div>
</div>
</div>
</div>
<div class="download-btn-container">
<button type="button" class="btn btn-primary" id="download-btn">Download QR Code</button>
</div>
</div>
</div>
</div>
</div>
<script>
const form = document.getElementById('qr-form');
const upiIdSelect = document.getElementById('upi-id');
const amountInput = document.getElementById('amount');
const descriptionSelect = document.getElementById('description-select');
const otherDescriptionInput = document.getElementById('other-description-text');
const otherDescriptionContainer = document.getElementById('other-description');
const quantityInput = document.getElementById('quantity');
const quantityField = document.getElementById('quantity-field');
const modalBody = document.getElementById('modal-body');
const upiIdModalLabel2 = document.getElementById('upi-id-modal-label2');
const descriptionModalLabel = document.getElementById('description-modal-label');
const quantityModalLabel = document.getElementById('quantity-modal-label');
const amountValue = document.getElementById('amount-value');
const qrcodeModal = document.getElementById('qrcode-modal');
const downloadBtn = document.getElementById('download-btn');
const errorMessage = document.getElementById('error-message');

descriptionSelect.addEventListener('change', () => {
    if (descriptionSelect.value === '') { // "Other" selected
        otherDescriptionContainer.style.display = 'block';
        quantityField.style.display = 'none'; // hide quantity for "Other"
    } else {
        otherDescriptionContainer.style.display = 'none';
        quantityField.style.display = 'block'; // show quantity for predefined
    }
});

form.addEventListener('submit', generateQRCode);

function generateQRCode(e) {
    e.preventDefault();

    const upiId = upiIdSelect.value;
    const amount = parseFloat(amountInput.value);
    let description = descriptionSelect.value;

    // Handle "Other" description
    if (description === '') { // "Other" selected
        description = otherDescriptionInput.value.trim();
        if (description === '') {
            errorMessage.textContent = 'Please enter a description.';
            return;
        }
    }

    // Validate amount
    if (upiId === '' || isNaN(amount) || amount < 0) {
        errorMessage.textContent = 'Please fill in all fields with valid values';
        return;
    }

    // Validate quantity only if not "Other"
    let quantity = 1;
    if (descriptionSelect.value !== '') { // predefined options
        quantity = parseInt(quantityInput.value);
        if (isNaN(quantity) || quantity < 1) {
            errorMessage.textContent = 'Please enter a valid quantity';
            return;
        }
    } else {
        // For "Other", validate description text
        // Already validated above
        quantity = 1; // optional, not used for "Other"
    }

    // Construct UPI URL
    const upiLink = `upi://pay?pa=${upiId}&pn=Payment&mc=0000&tid=OrderID&tn=${encodeURIComponent(description)}&tr=TransactionRefId&am=${amount}&url=`;

    // Set modal info
    upiIdModalLabel2.textContent = '(PRINTING PRESS)';
    descriptionModalLabel.textContent = description;
    document.getElementById('quantity-modal-label').textContent = (descriptionSelect.value !== '') ? `Quantity: ${quantity}` : '';
    amountValue.textContent = `â‚¹${amount}`;

    // Generate QR code
    qrcodeModal.innerHTML = '';
    new QRCode(qrcodeModal, {
        text: upiLink,
        width: 200,
        height: 200,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
    });

    // Show modal
    $('#myModal').modal('show');
    errorMessage.textContent = '';
}

function downloadImage() {
    html2canvas(document.getElementById('qrcode-wrapper'), {
        allowTaint: true,
        useCORS: true,
        backgroundColor: "#4f6377"
    }).then(canvas => {
        const dataURL = canvas.toDataURL('image/jpeg');
        const a = document.createElement('a');
        a.href = dataURL;
        a.download = 'qrcode.jpg';
        a.click();
    });
}

function closeModal() {
    // Reset form
    document.getElementById('qr-form').reset();
    otherDescriptionContainer.style.display = 'none';
    quantityField.style.display = 'block';
    errorMessage.textContent = '';
    qrcodeModal.innerHTML = '';
    document.getElementById('quantity-modal-label').textContent = '';
    amountValue.textContent = '';
    $('#myModal').modal('hide');
}

document.getElementById('download-btn').addEventListener('click', downloadImage);

$(document).ready(function() {
    $('#myModal').on('hidden.bs.modal', function() {
        closeModal();
    });
});
</script>
</body>
</html>